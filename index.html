const repoUser = "indexmod";
const repoName = "byob";

const localPages = [
  `https://${repoUser}.github.io/${repoName}/F%20L%20U%20I%20D.html`,
  `https://${repoUser}.github.io/${repoName}/M%20A%20S%20K.html`
];

async function getWeblocUrl(path) {
  try {
    const response = await fetch(path);
    const text = await response.text();
    const parser = new DOMParser();
    const xml = parser.parseFromString(text, "application/xml");
    const urlNode = xml.querySelector("string");
    if (urlNode && urlNode.textContent) {
      return urlNode.textContent.trim();
    }
  } catch (e) {
    console.error("Ошибка при чтении webloc:", e);
  }
  return null;
}

async function start() {
  const weblocUrl = await getWeblocUrl(`https://${repoUser}.github.io/${repoName}/L%20I%20M%20I.webloc`);

  const sites = [...localPages];
  if (weblocUrl) {
    sites.push(weblocUrl);
  } else {
    console.warn("Не удалось загрузить URL из L I M I.webloc");
  }

  if (sites.length === 0) {
    console.error("Нет страниц для отображения");
    return;
  }

  let current = 0;
  const iframe = document.getElementById('player');

  function switchSite() {
    iframe.src = sites[current];
    current = (current + 1) % sites.length;
  }

  switchSite();
  setInterval(switchSite, 3 * 60 * 1000);
}

start();
